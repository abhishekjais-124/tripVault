{% extends 'user/base.html' %}
{% load static %}
{% block title %} Login {% endblock title %}

{% block body %}
<div class="min-h-screen flex flex-col items-center justify-start px-2" style="overflow: hidden;">
    <div class="w-full max-w-md">
        <!-- Welcome Card -->
        <div class="glass rounded-2xl p-2 mb-2 text-center" style="margin-top:3rem;">
            <div class="w-10 h-10 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-2">
                <i class="fas fa-sign-in-alt text-white text-2xl"></i>
            </div>
            <h2 class="text-xl font-bold gradient-text mb-1">Welcome</h2>
            <p class="text-gray-400 text-xs mb-1">Sign in to manage your trips with ease</p>
        </div>

        <!-- Login Form -->
        <div class="glass rounded-3xl p-3 shadow-2xl border border-gray-700/50">
            {% if form.non_field_errors %}
            <div class="glass rounded-xl p-4 mb-6 border-l-4 border-red-500 text-red-100">
                <strong>{{ form.non_field_errors.as_text }}</strong>
            </div>
            {% endif %}

            <form method="post" class="space-y-6" id="loginForm">
                {% csrf_token %}
                
                {% for field in form %}
                    <div class="space-y-0.5">
                        <label for="{{ field.id_for_label }}" class="block text-xs font-bold text-gray-200 uppercase tracking-wide mb-1">
                            {{ field.label }}
                        </label>
                        <div class="relative">
                            {% if field.field.widget.input_type == 'password' %}
                                <i class="fas fa-lock absolute left-3 top-1/2 transform -translate-y-1/2 text-cyan-400 z-10 pointer-events-none"></i>
                            {% else %}
                                <i class="fas fa-user absolute left-3 top-1/2 transform -translate-y-1/2 text-cyan-400 z-10 pointer-events-none"></i>
                            {% endif %}
                            {% if field.field.widget.input_type == 'password' %}
                                <input type="password" name="{{ field.html_name }}" id="{{ field.id_for_label }}" class="login-input" placeholder="Enter your password" required />
                            {% elif field.field.widget.input_type == 'text' %}
                                <input type="text" name="{{ field.html_name }}" id="{{ field.id_for_label }}" class="login-input" placeholder="Enter your username" required />
                            {% else %}
                                {{ field }}
                            {% endif %}
                            <script>
                            // Prevent spaces in username and password fields
                            document.addEventListener('DOMContentLoaded', function() {
                                var inputs = document.querySelectorAll('input[type="text"], input[type="password"]');
                                inputs.forEach(function(input) {
                                    input.addEventListener('keydown', function(e) {
                                        if (e.key === ' ') e.preventDefault();
                                    });
                                    input.addEventListener('input', function(e) {
                                        this.value = this.value.replace(/\s/g, '');
                                    });
                                });
                            });
                            </script>
                            {% if field.errors %}
                                <div class="text-red-400 text-sm mt-2">
                                    {{ field.errors }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}


                <button type="submit" class="w-full bg-gradient-to-r from-cyan-500 via-blue-500 to-blue-600 hover:from-cyan-600 hover:via-blue-600 hover:to-blue-700 text-white font-bold py-2 px-3 rounded-2xl transition-all duration-300 transform hover:shadow-2xl active:scale-95 text-sm">
                    <i class="fas fa-sign-in-alt mr-2"></i> Sign In
                </button>

                <!-- Loader (hidden by default, matches app loader) -->
                <div id="loginLoader" style="display:none;" class="flex justify-center mt-4">
                    <div class="loader-zoom">
                        <div class="loader-circle" style="display:flex; align-items:center; justify-content:center;">
                            <span class="loader-icon">
                                <svg width="38" height="38" viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <defs>
                                        <linearGradient id="icon-gradient-login" x1="0" y1="0" x2="38" y2="38" gradientUnits="userSpaceOnUse">
                                            <stop stop-color="#06b6d4"/>
                                            <stop offset="1" stop-color="#3b82f6"/>
                                        </linearGradient>
                                    </defs>
                                    <circle cx="19" cy="19" r="16" stroke="url(#icon-gradient-login)" stroke-width="3" fill="none"/>
                                    <path d="M19 10L24 19H14L19 10Z" fill="url(#icon-gradient-login)"/>
                                    <circle cx="19" cy="25" r="2.5" fill="url(#icon-gradient-login)"/>
                                </svg>
                            </span>
                        </div>
                    </div>
                </div>
<style>
    .loader-zoom {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        animation: loader-zoom-in 1.2s cubic-bezier(0.4,0,0.2,1) infinite alternate;
    }
    .loader-circle {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        border: 6px solid #06b6d4;
        border-top: 6px solid #3b82f6;
        border-bottom: 6px solid #0ea5e9;
        background: rgba(30,41,59,0.25);
        box-shadow: 0 0 32px 0 rgba(6,182,212,0.15);
        animation: loader-spin 1.1s linear infinite;
    }
    @keyframes loader-spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    @keyframes loader-zoom-in {
        0% { transform: scale(1); }
        100% { transform: scale(1.15); }
    }
</style>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var loginForm = document.getElementById('loginForm');
    var loader = document.getElementById('loginLoader');
    if (loginForm && loader) {
        loginForm.addEventListener('submit', function() {
            loader.style.display = 'flex';
        });
    }
});
</script>

                <!-- Forgot Password Link -->
                <div class="text-center">
                    <a href="{% url 'forgot_password' %}" class="text-cyan-400 hover:text-cyan-300 text-sm hover:underline">
                        Forgot Password?
                    </a>
                </div>
            </form>

            <!-- Divider -->
            <div class="flex items-center my-2">
                <div class="flex-1 border-t border-gray-600"></div>
                <div class="px-4 text-gray-500 text-sm font-medium">OR</div>
                <div class="flex-1 border-t border-gray-600"></div>
            </div>

            <!-- Register Link -->
            <div class="text-center">
                <p class="text-gray-400 text-sm">
                    Don't have an account?
                    <a href="{% url 'customerregistration' %}" class="gradient-text font-bold hover:underline transition-all">
                        Create one now
                    </a>
                </p>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-2">
            <p class="text-gray-500 text-xs">
                <i class="fas fa-shield-alt mr-1"></i> Your data is secure and encrypted
            </p>
        </div>
    </div>
</div>

<style>
    /* Reset all form control styling */
    .login-input {
        width: 100% !important;
        background: linear-gradient(to bottom right, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05)) !important;
        border: 1px solid rgba(107, 114, 128, 0.5) !important;
        color: white !important;
        border-radius: 0.75rem !important;
        padding: 0.5rem 0.8rem 0.5rem 2rem !important;
        font-size: 0.9rem !important;
        transition: all 0.3s ease !important;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1) !important;
    }

    .login-input:hover {
        border-color: rgba(107, 114, 128, 0.7) !important;
    }

    .login-input:focus {
        outline: none !important;
        border-color: #06b6d4 !important;
        box-shadow: 0 0 0 2px rgba(6, 182, 212, 0.3), 0 10px 15px -3px rgba(0, 0, 0, 0.1) !important;
    }

    .login-input::placeholder {
        color: rgba(156, 163, 175, 0.7) !important;
    }

    /* Hide any default password toggle icons from browsers */
    .login-input[type="password"]::-ms-reveal,
    .login-input[type="password"]::-ms-clear {
        display: none !important;
    }

    .login-input[type="password"]::-webkit-contacts-auto-fill-button,
    .login-input[type="password"]::-webkit-credentials-auto-fill-button {
        visibility: hidden !important;
        display: none !important;
        pointer-events: none !important;
        height: 0 !important;
        width: 0 !important;
        margin: 0 !important;
    }
</style>
<style>
    html, body {
        overflow: hidden !important;
        height: 100vh !important;
    }
</style>
{% endblock body %}
